# sales_userbot.py
# ูุฒุฑุจุงุช ูุฑูุด ุตูุช PeakTube - ุณุณุชู ูุฑูุด ููุดููุฏ ฺฉุงูู ุจุง ุจุฎุดโุจูุฏ ุชุฎุตุต ฺฉููุงุช ฺฉูุฏ ู ุงุฑุณุงู ุฎูุฏฺฉุงุฑ ูุด
# ูุณุฎู ููุง - ุญุฑููโุงุ ูพุงุฏุงุฑุ ุงูู ู ุจุฏูู ุชุฏุงุฎู + ุชุดุฎุต ู ฺฏุฒุงุฑุด ูพูู ุงูุชุฎุงุจโุดุฏู

import asyncio
import os
from telethon import TelegramClient, events, types
from telethon import functions
from telethon.tl.types import DocumentAttributeAudio  # ุถุฑูุฑ ุจุฑุง Voice Note ูุงูุน

# ==================== ุชูุธูุงุช ====================
api_id = 38060006                     # โ api_id ุฎูุฏุช ุฑุง ูุงุฑุฏ ฺฉู
api_hash = '1ad5106fa695c0e211901b33b8231aeb'  # โ api_hash ุฎูุฏุช ุฑุง ูุงุฑุฏ ฺฉู
session_name = 'peak_voice_admin'

# ุขุฏ ุนุฏุฏ ุฑุจุงุช ุงุตู (PeakTubeBot) - ุจุฑุง ุงุฑุณุงู ุฎูุฏฺฉุงุฑ ูุด
BOT_ID = 8462120028  # โ ุขุฏ ุนุฏุฏ ุฑุจุงุช ุงุตู ุฑุง ุงูุฌุง ูุงุฑุฏ ฺฉู (ุนุฏุฏ ฺฉุงูู)

# ุดูุงุฑู ฺฉุงุฑุช ุจุฑุง ุจุฎุด ูุงู
CARD_NUMBER = "6037-9919-1234-5678"   # โ ุดูุงุฑู ฺฉุงุฑุช ูุงูุน ุฎูุฏุช ุฑุง ูุงุฑุฏ ฺฉู

# ูุงูโูุง ุตูุช ูุดุงูุฑู (ุจุงุฏ ุฏุฑ ููุงู ูพูุดู ูพุฑูฺู ุจุงุดูุฏ)
VOICE_PREMIUM_7D = "premium_7d.mp3"     # ูพุฑููู ท ุฑูุฒู
VOICE_PREMIUM_1M = "premium_1m.mp3"     # ูพุฑููู ณฐ ุฑูุฒู
VOICE_PRO_7D     = "pro_7d.mp3"         # ุญุฑููโุง ท ุฑูุฒู
VOICE_PRO_1M     = "pro_1m.mp3"         # ุญุฑููโุง ณฐ ุฑูุฒู

# ูพุฑูฺฉุณ (ุฏุฑ ุตูุฑุช ูุงุฒ)
proxy = None

# ==================== ุญุงูุธู ูููุช ูพูู ุงูุชุฎุงุจโุดุฏู ฺฉุงุฑุจุฑ ====================
# ุฏฺฉุดูุฑ ุจุฑุง ุฐุฎุฑู ุขุฎุฑู ูพูู ุงูุชุฎุงุจโุดุฏู ุชูุณุท ูุฑ ฺฉุงุฑุจุฑ
# ฺฉูุฏ: user_idุ ููุฏุงุฑ: ูุงู ูุงุฑุณ ูพูู
user_selected_plan = {}

# ==================== ุชูุงุจุน ฺฉูฺฉ ====================
async def send_voice_with_recording_status(client: TelegramClient, event, file_path: str, duration: float = 1.5):
    if not os.path.exists(file_path):
        await event.reply(f"โ๏ธ ูุงู ุตูุช ุงูุช ูุดุฏ: {os.path.basename(file_path)}\nูุทูุงู ูุงู ุฑุง ุฏุฑ ูพูุดู ูพุฑูฺู ูุฑุงุฑ ุฏูุฏ.")
        return

    await client(functions.messages.SetTypingRequest(
        peer=event.chat_id,
        action=types.SendMessageRecordAudioAction()
    ))

    await asyncio.sleep(duration)

    try:
        await event.reply(
            file=file_path,
            attributes=[DocumentAttributeAudio(duration=60, voice=True)]
        )
        await client.send_read_acknowledge(event.chat_id, max_id=event.message.id)
    except Exception as e:
        await event.reply(f"โ๏ธ ุฎุทุง ุฏุฑ ุงุฑุณุงู ูุณ: {str(e)}")
    finally:
        await client(functions.messages.SetTypingRequest(
            peer=event.chat_id,
            action=types.SendMessageCancelAction()
        ))

# ==================== ฺฉูุงูุช ุงุตู ====================
client = TelegramClient(session_name, api_id, api_hash, proxy=proxy)

@client.on(events.NewMessage(incoming=True))
async def handler(event):
    # ููุท ูพุงูโูุง ุฎุตูุต
    if not event.is_private:
        return

    # ุฏุฑุงูุช sender ุจู ุตูุฑุช ุงูู
    try:
        sender = await event.get_sender()
    except Exception:
        return

    if sender is None:
        return

    # ููุชุฑ ุงููุช ุณุฎุชโฺฏุฑุงูู: ูุงุฏุฏู ฺฏุฑูุชู ุฑุจุงุชโูุง ู ูพุงูโูุง ุฎูุฏ ูุฒุฑุจุงุช (Self/Out)
    if getattr(sender, 'bot', False):
        return

    me = await client.get_me()
    if sender.id == me.id:
        return

    # ุฏุฑุงูุช ูุชู ูพุงู ู ุชุดุฎุต ุชุตูุฑ
    text = (event.message.message or "").strip().lower()
    original_text = event.message.message or ""
    has_photo = bool(event.message.photo)

    # ุชุนุฑู ุฏฺฉุดูุฑ ฺฉููุงุช ฺฉูุฏ (ุจุฎุดโุจูุฏ CRM)
    KEYWORDS = {
        "ุณูุงู": ["ุณูุงู", "ุฏุฑูุฏ", "ุณูุง", "ููุช ุจุฎุฑ", "ุฎุณุชู ูุจุงุดุฏ", "hi", "hello", "ุณูุงู ุนุฒุฒ"],
        "ูู": ["ุณุฑุนุช", "ฺฉูุช", "ุญุฌู", "ูุญุฏูุฏุช", "ูุทุน", "ููู ุงฺ ุฏ", "4k", "ุฏุงูููุฏ ุณุฑุน"],
        "ูพุดุชุจุงู": ["ุงุฏูู", "ูพุดุชุจุงู", "ูพุดุชุจุงู", "ูุฏุฑ", "ุงูพุฑุงุชูุฑ", "ูุตู ฺฉู", "ุงุฑุชุจุงุท ุจุง ุงุฏูู"],
        "ุชุฎูู": ["ุชุฎูู", "ุงุฑุฒูู", "ููุช ุขุฎุฑ", "ฺฉุฏ ุชุฎูู", "ุขู", "ุญุฑุงุฌ"],
        "ุงุนุชูุงุฏ": ["ูุทูุฆู", "ุงุนุชูุงุฏ", "ฺฉูุงูุจุฑุฏุงุฑ", "ุชุถูู", "ูุงูุน", "ููููู ฺฉุงุฑ", "ุฑุถุงุช"],
        "ูุงู": ["ฺฉุงุฑุช", "ูุงุฑุฒ", "ุดูุงุฑู ุญุณุงุจ", "ูุฒูู", "ฺุฌูุฑ ุจุฎุฑู", "ูพุฑุฏุงุฎุช", "ููุช"],
        "ุฏุฑุฎูุงุณุช_ูุด": ["ูุงุฑุฒ ฺฉุฑุฏู", "ูพุฑุฏุงุฎุช ุดุฏ", "ูุฑุณุชุงุฏู", "ุฑุณุฏ", "ูุด", "ุจูุฑุณุชู", "ุงูุชูุงู ุฏุงุฏู"],
        "ุชุดฺฉุฑ": ["ููููู", "ูุฑุณ", "ุณูพุงุณ", "ุฏูุช ฺฏุฑู", "ุนุงู ุจูุฏ", "ุชุดฺฉุฑ", "ุฎูุจู"],
        "ุฎุฏุงุญุงูุธ": ["ุฎุฏุงุญุงูุธ", "ูุนูุง", "ุง ุนู", "ุจุง", "ุฎุณุชู ูุจุงุด", "ูููู ุจุงุด"]
    }

    # ุงูููุช ุงูู: ูุดุงูุฑูโูุง ุตูุช (ด ูพูู ุฏูู) + ุฐุฎุฑู ูพูู ุงูุชุฎุงุจโุดุฏู
    if original_text == "ูุดุงูุฑู_ุณุฑูุณ_ููุช_ุฑูุฒู_ูพุฑููู":
        user_selected_plan[sender.id] = "ูพุฑููู ููุชโุฑูุฒู"  # ุฐุฎุฑู ูพูู
        await event.reply(
            "ุจุง ุฏุฑูุฏ ู ุงุญุชุฑุงูุ\n"
            "ุฏุฑุฎูุงุณุช ุดูุง ุฌูุช ุฏุฑุงูุช ุงุทูุงุนุงุช ูพูู **ูพุฑููู ููุชโุฑูุฒู** ุฏุฑุงูุช ุดุฏ.\n"
            "ูุทูุงู ุจู ุฑุงูููุง ุตูุช ุฒุฑ ุชูุฌู ูุฑูุงุฏ:"
        )
        await asyncio.sleep(1)
        await send_voice_with_recording_status(client, event, VOICE_PREMIUM_7D, duration=1.5)
        return

    elif original_text == "ูุดุงูุฑู_ุณุฑูุณ_ฺฉ_ูุงูู_ูพุฑููู":
        user_selected_plan[sender.id] = "ูพุฑููู ฺฉโูุงูู"  # ุฐุฎุฑู ูพูู
        await event.reply(
            "ุจุง ุฏุฑูุฏ ู ุงุญุชุฑุงูุ\n"
            "ุฏุฑุฎูุงุณุช ุดูุง ุฌูุช ุฏุฑุงูุช ุงุทูุงุนุงุช ูพูู **ูพุฑููู ฺฉโูุงูู** ุฏุฑุงูุช ุดุฏ.\n"
            "ูุทูุงู ุจู ุฑุงูููุง ุตูุช ุฒุฑ ุชูุฌู ูุฑูุงุฏ:"
        )
        await asyncio.sleep(1)
        await send_voice_with_recording_status(client, event, VOICE_PREMIUM_1M, duration=1.5)
        return

    elif original_text == "ูุดุงูุฑู_ุณุฑูุณ_ููุช_ุฑูุฒู_ุญุฑูู_ุง":
        user_selected_plan[sender.id] = "ุญุฑููโุง ููุชโุฑูุฒู"  # ุฐุฎุฑู ูพูู
        await event.reply(
            "ุจุง ุฏุฑูุฏ ู ุงุญุชุฑุงูุ\n"
            "ุฏุฑุฎูุงุณุช ุดูุง ุฌูุช ุฏุฑุงูุช ุงุทูุงุนุงุช ูพูู **ุญุฑููโุง ููุชโุฑูุฒู** ุฏุฑุงูุช ุดุฏ.\n"
            "ูุทูุงู ุจู ุฑุงูููุง ุตูุช ุฒุฑ ุชูุฌู ูุฑูุงุฏ:"
        )
        await asyncio.sleep(1)
        await send_voice_with_recording_status(client, event, VOICE_PRO_7D, duration=1.5)
        return

    elif original_text == "ูุดุงูุฑู_ุณุฑูุณ_ฺฉ_ูุงูู_ุญุฑูู_ุง":
        user_selected_plan[sender.id] = "ุญุฑููโุง ฺฉโูุงูู"  # ุฐุฎุฑู ูพูู
        await event.reply(
            "ุจุง ุฏุฑูุฏ ู ุงุญุชุฑุงูุ\n"
            "ุฏุฑุฎูุงุณุช ุดูุง ุฌูุช ุฏุฑุงูุช ุงุทูุงุนุงุช ูพูู **ุญุฑููโุง ฺฉโูุงูู** ุฏุฑุงูุช ุดุฏ.\n"
            "ูุทูุงู ุจู ุฑุงูููุง ุตูุช ุฒุฑ ุชูุฌู ูุฑูุงุฏ:"
        )
        await asyncio.sleep(1)
        await send_voice_with_recording_status(client, event, VOICE_PRO_1M, duration=1.5)
        return

    # ุงูููุช ุฏูู: ุชุดุฎุต ู ุงุฑุณุงู ุฎูุฏฺฉุงุฑ ูุด (ุนฺฉุณ) + ฺฏุฒุงุฑุด ูพูู
    if has_photo:
        # ุฏุฑุงูุช ูพูู ุงูุชุฎุงุจโุดุฏู (ุงฺฏุฑ ูุฌูุฏ ูุฏุงุดุชุ ูุงูุดุฎุต)
        selected_plan = user_selected_plan.get(sender.id, "ูุงูุดุฎุต")

        # ุงุฑุณุงู ุชุตูุฑ ูุด ุจู ุฑุจุงุช ุงุตู ุจุง ูุฑูุช ุฏูู ฺฉูพุดู
        try:
            await client.send_file(
                BOT_ID,
                event.message.photo,
                caption=f"#FINANCE_REPORT USER_ID: {sender.id} PLAN: {selected_plan}"
            )

            # ูพุงฺฉุณุงุฒ ุญุงูุธู ูพูู ุจุนุฏ ุงุฒ ุงุฑุณุงู ูููู
            if sender.id in user_selected_plan:
                del user_selected_plan[sender.id]
        except Exception as e:
            print(f"ุฎุทุง ุฏุฑ ุงุฑุณุงู ูุด ุจู ุฑุจุงุช ุงุตู: {e}")

        # ูพุงุณุฎ ุจู ฺฉุงุฑุจุฑ ุจุง ุฐฺฉุฑ ูพูู
        plan_mention = f"ูพูู {selected_plan}" if selected_plan != "ูุงูุดุฎุต" else "ุฏุฑุฎูุงุณุช ุดูุง"
        await event.reply(
            f"ุณูพุงุณ ุงุฒ ุงุนุชูุงุฏ ุดูุง ๐\n"
            f"ุฑุณุฏ ุดูุง ุจุฑุง {plan_mention} ุฏุฑุงูุช ุดุฏ ู ุจู ูพูู ูุฏุฑุช ุงุฑุณุงู ฺฏุฑุฏุฏ.\n"
            f"ูุทูุงู ููุชุธุฑ ุชุงุฏ ููุง ู ูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ ุจุงุดุฏ.\n"
            f"ุจู ุฒูุฏ ุงุฒ ุทุฑู ุฑุจุงุช ุงุตู ุงุทูุงุนโุฑุณุงู ุฎูุงูุฏ ุดุฏ."
        )
        return

    # ุงูููุช ุณูู: ุฏุฑุฎูุงุณุช ูุด (ุจุฏูู ุนฺฉุณ ุงูุง ุงุฏุนุง ูพุฑุฏุงุฎุช)
    if any(word in text for word in KEYWORDS["ุฏุฑุฎูุงุณุช_ูุด"]):
        await event.reply(
            "ุจุง ุฏุฑูุฏุ\n"
            "ุฌูุช ุซุจุช ู ูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉุ ูุทูุงู ุชุตูุฑ (ุงุณฺฉุฑูโุดุงุช) ูุงุถุญ ุฑุณุฏ ูุงุฑุฒ ุฎูุฏ ุฑุง ุฏุฑ ูููโุฌุง ุงุฑุณุงู ฺฉูุฏ.\n"
            "ุชุง ุฒูุงู ฺฉู ุชุตูุฑ ุฑุณุฏ ุฏุฑุงูุช ูุดูุฏุ ุงูฺฉุงู ูพุฑุฏุงุฒุด ู ูุนุงูโุณุงุฒ ูุฌูุฏ ูุฏุงุฑุฏ ๐"
        )
        return

    # ุงูููุช ฺูุงุฑู: ูพุงุณุฎโูุง ูุชู ุชูฺฉฺฉโุดุฏู ุจุฑ ุงุณุงุณ ฺฉููุงุช ฺฉูุฏ
    responded = False

    if any(word in text for word in KEYWORDS["ุณูุงู"]):
        await event.reply(
            "ุจุง ุฏุฑูุฏ ู ุงุญุชุฑุงูุ\n"
            "ุฎูุด ุขูุฏุฏ ุจู ูุงุญุฏ ูุฑูุด PeakTube ๐น\n"
            "ุฏุฑ ุฎุฏูุช ุดูุง ูุณุชู. ูุทูุงู ูพูู ููุฑุฏ ูุธุฑ ุง ุณูุงู ุฎูุฏ ุฑุง ูุทุฑุญ ูุฑูุงุฏ."
        )
        responded = True

    elif any(word in text for word in KEYWORDS["ูู"]):
        await event.reply(
            "ุจุง ุฏุฑูุฏุ\n"
            "ุฏุฑ ูพููโูุง VIP ูุง:\n"
            "โข ุญุฏุงฺฉุซุฑ ุณุฑุนุช ุฏุงูููุฏ (ุจุฏูู ูุญุฏูุฏุช ูพููุง ุจุงูุฏ)\n"
            "โข ฺฉูุช ุชุง ดK ู ุจุงูุงุชุฑ (ุฏุฑ ูพูู ุญุฑููโุง)\n"
            "โข ุจุฏูู ูุญุฏูุฏุช ุญุฌู ุง ุชุนุฏุงุฏ ุฏุงูููุฏ ุฑูุฒุงูู\n"
            "โข ูพุงุฏุงุฑ ุจุงูุง ู ุจุฏูู ูุทุน\n"
            "ุชุฌุฑุจูโุง ฺฉุงููุงู ุญุฑููโุง ุฎูุงูุฏ ุฏุงุดุช ๐"
        )
        responded = True

    elif any(word in text for word in KEYWORDS["ูพุดุชุจุงู"]):
        await event.reply(
            "ุจุง ุฏุฑูุฏุ\n"
            "ุดูุง ูุณุชููุงู ุจุง ูุงุญุฏ ูุฑูุด ุฏุฑ ุงุฑุชุจุงุท ูุณุชุฏ.\n"
            "ุชูุงู ุณูุงูุงุช ู ุฏุฑุฎูุงุณุชโูุง ุดูุง ุฏุฑ ุณุฑุนโุชุฑู ุฒูุงู ููฺฉู ุจุฑุฑุณ ู ูพุงุณุฎ ุฏุงุฏู ูโุดูุฏ.\n"
            "ูุทูุงู ุณูุงู ุฎูุฏ ุฑุง ูุทุฑุญ ูุฑูุงุฏ ๐"
        )
        responded = True

    elif any(word in text for word in KEYWORDS["ุชุฎูู"]):
        await event.reply(
            "ุจุง ุฏุฑูุฏุ\n"
            "ุจูุชุฑู ุงุฑุฒุด ุฎุฑุฏ ุฏุฑ ูพููโูุง ฺฉโูุงูู ุงุณุช!\n"
            "ุจุง ุงูุชุฎุงุจ ูพูู ฺฉโูุงููุ ูุฒูู ุฑูุฒุงูู ุจู ุญุฏุงูู ูโุฑุณุฏ.\n"
            "ุชูุตู ูุง: ูพูู ุญุฑููโุง ฺฉโูุงูู ุจุฑุง ุจูุชุฑู ุชุฌุฑุจู ู ุงุฑุฒุด ๐"
        )
        responded = True

    elif any(word in text for word in KEYWORDS["ุงุนุชูุงุฏ"]):
        await event.reply(
            "ุจุง ุฏุฑูุฏุ\n"
            "PeakTube ุจุง ุจุด ุงุฒ ุฏู ุณุงู ูุนุงูุช ูููู ู ูุฒุงุฑุงู ฺฉุงุฑุจุฑ ุฑุงุถุ\n"
            "ฺฉ ุงุฒ ูุนุชุจุฑุชุฑู ุณุฑูุณโูุง ุฏุงูููุฏ ูุชูุจ ุฏุฑ ุงุฑุงู ุงุณุช.\n"
            "ูพุฑุฏุงุฎุช ูุณุชูู ุจู ูุฏุฑุช ู ูุนุงูโุณุงุฒ ุฏุณุชุ ุชุถูู ุงููุช ู ุณุฑุนุช ุดูุงุณุช.\n"
            "ุฑุถุงุช ุดูุง ุงูููุช ูุงุณุช ๐"
        )
        responded = True

    elif any(word in text for word in KEYWORDS["ูุงู"]):
        await event.reply(
            f"ุจุง ุฏุฑูุฏ ู ุงุญุชุฑุงูุ\n"
            f"ุฌูุช ูพุฑุฏุงุฎุชุ ูุทูุงู ูุจูุบ ูพูู ุงูุชุฎุงุจ ุฑุง ุจู ุดูุงุฑู ฺฉุงุฑุช ุฒุฑ ูุงุฑุฒ ููุงุฏ:\n\n"
            f"๐ณ `{CARD_NUMBER}`\n"
            f"๐ ุจุงูฺฉ ููุช - ุจู ูุงู ูุฏุฑุช PeakTube\n\n"
            f"ูพุณ ุงุฒ ูุงุฑุฒุ ุชุตูุฑ ุฑุณุฏ ุฑุง ุฏุฑ ููู ฺุช ุงุฑุณุงู ูุฑูุงุฏ ุชุง ุจูุงูุงุตูู ูพุฑุฏุงุฒุด ุดูุฏ.",
            parse_mode='md'
        )
        responded = True

    elif any(word in text for word in KEYWORDS["ุชุดฺฉุฑ"]):
        await event.reply(
            "ุณูพุงุณ ูุฑุงูุงู ุงุฒ ูุทู ู ุงุนุชูุงุฏ ุดูุง ๐\n"
            "ุฎูุดุญุงูู ฺฉู ุฏุฑ ุฎุฏูุชุชุงู ุจูุฏู.\n"
            "ุฏุฑ ุตูุฑุช ูุงุฒ ูุฌุฏุฏุ ููุดู ุฏุฑ ุฏุณุชุฑุณ ูุณุชู ๐น"
        )
        responded = True

    elif any(word in text for word in KEYWORDS["ุฎุฏุงุญุงูุธ"]):
        await event.reply(
            "ุจุง ุขุฑุฒู ููููุช ุจุฑุง ุดูุงุ\n"
            "ุฏุฑ ุตูุฑุช ูุงุฒ ูุฌุฏุฏุ ุจุง ฺฉูุงู ูู ุฏุฑ ุฎุฏูุช ูุณุชู ๐\n"
            "ุฑูุฒ ุฎูุจ ุฏุงุดุชู ุจุงุดุฏ!"
        )
        responded = True

# ==================== ุงุฌุฑุง ====================
async def main():
    print("ูุฒุฑุจุงุช ูุฑูุด ุตูุช PeakTube (ุณุณุชู ููุดููุฏ ุจุง ุชุดุฎุต ูพูู ู ฺฏุฒุงุฑุด ุฏูู) ุฏุฑ ุญุงู ุงุฌุฑุงุณุช...")
    print("ูฺฺฏโูุง ุฌุฏุฏ:")
    print("  โข ุญุงูุธู ูููุช ุจุฑุง ุขุฎุฑู ูพูู ุงูุชุฎุงุจโุดุฏู ูุฑ ฺฉุงุฑุจุฑ")
    print("  โข ฺฏุฒุงุฑุด ุฏูู ูพูู ุฏุฑ ฺฉูพุดู ูุด (#FINANCE_REPORT USER_ID: ... PLAN: ...)")
    print("  โข ุฐฺฉุฑ ูุงู ูพูู ุฏุฑ ุชุงุฏู ุจู ฺฉุงุฑุจุฑ")
    print("  โข ูพุงฺฉุณุงุฒ ุฎูุฏฺฉุงุฑ ุญุงูุธู ูพุณ ุงุฒ ุงุฑุณุงู ูููู ูุด")
    print("\nูุงูโูุง ุตูุช ููุฑุฏ ูุงุฒ:")
    print(f"  - {VOICE_PREMIUM_7D}")
    print(f"  - {VOICE_PREMIUM_1M}")
    print(f"  - {VOICE_PRO_7D}")
    print(f"  - {VOICE_PRO_1M}")
    print("\nุจุฑุง ุฎุฑูุฌ Ctrl+C ุจุฒูุฏ.")

    await client.start()
    await client.run_until_disconnected()

if __name__ == '__main__':
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("\nุฑุจุงุช ูุชููู ุดุฏ.")